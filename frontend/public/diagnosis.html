<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œè¯Šæ–­</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        .success { background: #4caf50; color: white; }
        .error { background: #f44336; color: white; }
        .loading { background: #ff9800; color: white; }
        pre {
            background: #263238;
            color: #aed581;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            font-size: 12px;
        }
        h2 { color: #333; margin-top: 0; }
        .info { color: #666; font-size: 14px; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” ç½‘ç»œè¯Šæ–­å·¥å…·</h1>
    
    <div class="test-item">
        <h2>ğŸ“± è®¾å¤‡ä¿¡æ¯</h2>
        <div class="info">
            <strong>User Agent:</strong><br>
            <pre id="userAgent"></pre>
        </div>
        <div class="info">
            <strong>å±å¹•å°ºå¯¸:</strong> <span id="screenSize"></span>
        </div>
        <div class="info">
            <strong>å½“å‰URL:</strong> <span id="currentUrl"></span>
        </div>
    </div>

    <div class="test-item">
        <h2>ğŸŒ åç«¯APIæµ‹è¯•</h2>
        <p>
            æµ‹è¯•API: <code id="apiUrl"></code>
            <span id="apiStatus" class="status loading">æµ‹è¯•ä¸­...</span>
        </p>
        <div id="apiResult"></div>
    </div>

    <div class="test-item">
        <h2>ğŸ¨ å‰ç«¯èµ„æºæµ‹è¯•</h2>
        <p>
            React Adminé¡µé¢: <a href="/#/approval_tasks/10/show" target="_blank">ç‚¹å‡»è®¿é—®</a>
            <span id="reactStatus" class="status loading">æ£€æŸ¥ä¸­...</span>
        </p>
        <div id="reactResult"></div>
    </div>

    <div class="test-item">
        <h2>ğŸ“‹ æµ‹è¯•ç»“æœ</h2>
        <div id="summary"></div>
    </div>

    <script>
        const hostname = window.location.hostname;
        const apiUrl = `http://${hostname}:8001/api/approval_tasks/10`;
        
        // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('screenSize').textContent = 
            `${window.innerWidth} x ${window.innerHeight}`;
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('apiUrl').textContent = apiUrl;

        // æµ‹è¯•åç«¯API
        console.log('å¼€å§‹æµ‹è¯•API:', apiUrl);
        
        fetch(apiUrl)
            .then(response => {
                console.log('APIå“åº”çŠ¶æ€:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('APIæ•°æ®:', data);
                document.getElementById('apiStatus').className = 'status success';
                document.getElementById('apiStatus').textContent = 'âœ“ æˆåŠŸ';
                document.getElementById('apiResult').innerHTML = `
                    <div class="info">
                        <strong>âœ“ åç«¯APIæ­£å¸¸</strong><br>
                        ä»»åŠ¡ID: ${data.id}<br>
                        çŠ¶æ€: ${data.status}<br>
                        ä¸»é¢˜: ${data.draft_subject}<br>
                        å›å¤å†…å®¹é•¿åº¦: ${data.draft_body ? data.draft_body.length : 0} å­—ç¬¦
                    </div>
                `;
                updateSummary('api', true, 'åç«¯APIå“åº”æ­£å¸¸');
            })
            .catch(error => {
                console.error('APIé”™è¯¯:', error);
                document.getElementById('apiStatus').className = 'status error';
                document.getElementById('apiStatus').textContent = 'âœ— å¤±è´¥';
                document.getElementById('apiResult').innerHTML = `
                    <div class="info" style="color: red;">
                        <strong>âœ— åç«¯APIè¿æ¥å¤±è´¥</strong><br>
                        é”™è¯¯: ${error.message}<br><br>
                        <strong>å¯èƒ½åŸå› :</strong><br>
                        1. åç«¯æœåŠ¡æœªå¯åŠ¨ (ç«¯å£8001)<br>
                        2. é˜²ç«å¢™é˜»æ­¢äº†è¿æ¥<br>
                        3. ç½‘ç»œè¿æ¥é—®é¢˜
                    </div>
                `;
                updateSummary('api', false, `åç«¯APIå¤±è´¥: ${error.message}`);
            });

        // æµ‹è¯•ReactåŠ è½½
        setTimeout(() => {
            try {
                // æ£€æŸ¥React Adminæ˜¯å¦åŠ è½½
                const reactRoot = document.querySelector('#root');
                if (reactRoot) {
                    document.getElementById('reactStatus').className = 'status success';
                    document.getElementById('reactStatus').textContent = 'âœ“ å·²åŠ è½½';
                    document.getElementById('reactResult').innerHTML = `
                        <div class="info">
                            <strong>âœ“ React Adminå·²åŠ è½½</strong>
                        </div>
                    `;
                    updateSummary('react', true, 'React Adminå·²åŠ è½½');
                } else {
                    throw new Error('æœªæ‰¾åˆ°Reactæ ¹å…ƒç´ ');
                }
            } catch (error) {
                document.getElementById('reactStatus').className = 'status error';
                document.getElementById('reactStatus').textContent = 'âœ— æœªåŠ è½½';
                document.getElementById('reactResult').innerHTML = `
                    <div class="info" style="color: red;">
                        <strong>âœ— React Adminæœªæ­£ç¡®åŠ è½½</strong><br>
                        è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¯Šæ–­é¡µé¢
                    </div>
                `;
                updateSummary('react', false, 'React AdminæœªåŠ è½½ï¼ˆæ­£å¸¸ï¼‰');
            }
        }, 1000);

        const summaryResults = {};
        
        function updateSummary(test, success, message) {
            summaryResults[test] = { success, message };
            
            const summaryDiv = document.getElementById('summary');
            let html = '<ul style="list-style: none; padding: 0;">';
            
            for (const [key, result] of Object.entries(summaryResults)) {
                const icon = result.success ? 'âœ“' : 'âœ—';
                const color = result.success ? 'green' : 'red';
                html += `<li style="color: ${color}; margin: 5px 0;">${icon} ${result.message}</li>`;
            }
            
            html += '</ul>';
            
            if (Object.keys(summaryResults).length >= 2) {
                const allSuccess = Object.values(summaryResults).every(r => r.success);
                if (allSuccess) {
                    html += `
                        <div style="background: #e8f5e9; padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <strong style="color: #2e7d32;">âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</strong><br>
                            å¦‚æœReact Adminé¡µé¢ä»ç„¶ç©ºç™½ï¼Œè¯·å°è¯•ï¼š<br>
                            1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜<br>
                            2. åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹JavaScripté”™è¯¯<br>
                            3. è®¿é—®: <a href="/#/approval_tasks/10/show">/#/approval_tasks/10/show</a>
                        </div>
                    `;
                } else {
                    html += `
                        <div style="background: #ffebee; padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <strong style="color: #c62828;">éƒ¨åˆ†æµ‹è¯•å¤±è´¥</strong><br>
                            è¯·æ ¹æ®ä¸Šé¢çš„é”™è¯¯ä¿¡æ¯æ’æŸ¥é—®é¢˜
                        </div>
                    `;
                }
            }
            
            summaryDiv.innerHTML = html;
        }
    </script>
</body>
</html>
